{
  "class": "ADC",
  "schemaVersion": "3.23.0",
  "id": "urn:uuid:6332f747-72a6-4862-ac62-8aad01369724",
  "label": "Converted Declaration",
  "remark": "Example AWS Gateway with Local Traffic Policies",
  "aws_gateway_tenant": {
    "class": "Tenant",
    "aws_gateway": {
      "class": "Application",
      "template": "generic",
      "tunnel_gateway": {
        "class": "Pool",
        "monitors": [
          {
            "bigip": "/Common/gateway_icmp"
          }
        ]
      },
      "gateway_vs_http": {
        "pool": "tunnel_gateway",
        "snat": "none",
        "class": "Service_HTTP",
        "layer4": "tcp",
        "allowVlans": [
          {
            "bigip": "/Common/geneve-tunnel"
          }
        ],
        "profileTCP": {
          "bigip": "/Common/tcp"
        },
        "profileHTTP": {
          "bigip": "/Common/http"
        },
        "policyEndpoint" : "awsgatewaywafhttpPolicy",
        "virtualAddresses": [
          "0.0.0.0%1"
        ],
        "translateClientPort": "preserve-strict",
        "translateServerPort": false,
        "translateServerAddress": false
      },
      "gateway_vs_https": {
        "pool": "tunnel_gateway",
        "snat": "none",
        "class": "Service_HTTPS",
        "layer4": "tcp",
        "serverTLS": "appclientssl",
        "clientTLS": {
          "bigip": "/Common/serverssl"
        },
        "allowVlans": [
          {
            "bigip": "/Common/geneve-tunnel"
          }
        ],
        "profileTCP": {
          "bigip": "/Common/tcp"
        },
        "redirect80": false,
        "profileHTTP": {
          "bigip": "/Common/http"
        },
        "policyEndpoint" : "awsgatewaywafhttpsPolicy",
        "virtualAddresses": [
          "0.0.0.0%1"
        ],
        "translateClientPort": "preserve-strict",
        "translateServerPort": false,
        "translateServerAddress": false
      },
      "awsgatewaywafhttpPolicy": {
        "class": "Endpoint_Policy",
        "strategy": "first-match",
        "rules": [
            {
              "name": "enableWAF",
                  "conditions": [
                    {
                      "type": "httpHeader",
                      "name":  "Host",
                      "all": {
                        "operand" : "contains",
                        "values" : [
                          "app1"
                        ]
                      }
                }
              ],
              "actions": [{
                      "type": "waf",
                      "policy":{ 
                        "use": "PolicyApp01"
                      }
                  }
              ]
            },
            {
              "name": "disableWAF",
              "conditions": [],
              "actions": [{
                      "type": "waf"
                  }
              ]
            }
        ]
      },
      "awsgatewaywafhttpsPolicy": {
        "class": "Endpoint_Policy",
        "strategy": "first-match",
        "rules": [
          {
            "name": "sni0",
              "conditions": [
                {
                      "type": "sslExtension",
                      "event": "ssl-client-hello",
                      "serverName": {
                          "operand": "equals",
                          "values": [
                              "test1.com"
                          ]
                      }
                }
              ],
              "actions": [
                {
                "type": "waf",
                "policy":{ 
                  "use": "PolicyApp01"
                }
                }
              ]
          },
          {
            "name": "sni1",
              "conditions": [
                    {
                        "type": "sslExtension",
                        "event": "ssl-client-hello",
                        "serverName": {
                            "operand": "equals",
                            "values": [
                                "test2.com"
                            ]
                        }
                    }
                ],
              "actions": [{
                  "type": "waf",
                  "policy":{ 
                    "use": "PolicyApp01"
                  }
                  }
                ]
          },
          {
            "name": "disableWAF",
              "conditions": [],
              "actions": [{
                    "type": "waf"
                }
            ]
          }
        ]
      },
      "PolicyApp01" : {
        "class": "WAF_Policy",
        "policy": {
          "base64" : "ewogICAgInBvbGljeSI6IHsKICAgICAgICAibmFtZSI6ICJQb2xpY3lBcHAwMSIsCiAgICAgICAgImRlc2NyaXB0aW9uIjogIlBvbGljeUFwcDAxIERlc2NyaXB0aW9uIEV4YW1wbGUiLAogICAgICAgICJ0ZW1wbGF0ZSI6IHsKICAgICAgICAgICAgIm5hbWUiOiAiUE9MSUNZX1RFTVBMQVRFX1JBUElEX0RFUExPWU1FTlQiCiAgICAgICAgfSwKICAgICAgICAiZW5mb3JjZW1lbnRNb2RlIjogImJsb2NraW5nIiwKICAgICAgICAic2VydmVyLXRlY2hub2xvZ2llcyI6IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgInNlcnZlclRlY2hub2xvZ3lOYW1lIjogIk15U1FMIgogICAgICAgICAgICB9CiAgICAgICAgXSwKICAgICAgICAic2lnbmF0dXJlLXNldHRpbmdzIjogewogICAgICAgICAgICAic2lnbmF0dXJlU3RhZ2luZyI6IGZhbHNlCiAgICAgICAgfSwKICAgICAgICAic2lnbmF0dXJlcyI6IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgInNpZ25hdHVyZUlkIjogMjAwMTAxNTUyLAogICAgICAgICAgICAgICAgImVuYWJsZWQiOiBmYWxzZSwKICAgICAgICAgICAgICAgICJwZXJmb3JtU3RhZ2luZyI6IGZhbHNlCiAgICAgICAgICAgIH0KICAgICAgICBdLAogICAgICAgICJ3aGl0ZWxpc3QtaXBzIjogWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAiaXBBZGRyZXNzIjogIjEwLjAuMC4xIiwKICAgICAgICAgICAgICAgICJpcE1hc2siOiAiMjU1LjI1NS4yNTUuMjU1IiwKICAgICAgICAgICAgICAgICJkZXNjcmlwdGlvbiI6ICJhbHdheXMgYmxvY2sgdGhpcyBpcCBhZGRyZXNzIiwKICAgICAgICAgICAgICAgICJibG9ja1JlcXVlc3RzIjogImFsd2F5cyIKICAgICAgICAgICAgfQogICAgICAgIF0sCiAgICAgICAgImRpc2FsbG93ZWQtZ2VvbG9jYXRpb25zIjogWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAiY291bnRyeU5hbWUiOiAiQW1lcmljYW4gU2Ftb2EiCiAgICAgICAgICAgIH0KICAgICAgICBdCiAgICB9LAogICAgIm1vZGlmaWNhdGlvbnMiOiBbXQp9"
        },
        "ignoreChanges": false
      },
      "appclientssl": {
        "class": "TLS_Server",
        "certificates": [
            {
                "certificate": "testWebcert"
            }
        ]
      },
      "testWebcert": {
        "class": "Certificate",
        "certificate": "-----BEGIN CERTIFICATE-----\nMIID7TCCAtWgAwIBAgIJAJH4sMVzl1dMMA0GCSqGSIb3DQEBCwUAMIGMMQswCQYDVQQGEwJVUzETMBEGA1UECAwKV2FzaGluZ3RvbjEQMA4GA1UEBwwHU2VhdHRsZTELMAkGA1UECgwCRjUxDTALBgNVBAsMBFRlc3QxEzARBgNVBAMMCnRscy1zZXJ2ZXIxJTAjBgkqhkiG9w0BCQEWFnNvbWVib2R5QHNvbWV3aGVyZS5jb20wHhcNMTgwMjI4MTkwNzMyWhcNMjgwMjI2MTkwNzMyWjCBjDELMAkGA1UEBhMCVVMxEzARBgNVBAgMCldhc2hpbmd0b24xEDAOBgNVBAcMB1NlYXR0bGUxCzAJBgNVBAoMAkY1MQ0wCwYDVQQLDARUZXN0MRMwEQYDVQQDDAp0bHMtc2VydmVyMSUwIwYJKoZIhvcNAQkBFhZzb21lYm9keUBzb21ld2hlcmUuY29tMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwEMNPATg7Vz3jqInIVf2jnOi/9/HYIr8xZYgU0YHHFEiquQ6nYfX4mwezZ6zo9GJom7gHiQ3FNy3fN+RatatZmBmuyvJ+z/uZ6pbKmsuJLPLT89olO9JxMtb4a83oHDz3f6rcc2j8KwTr4lUDc452jLF4ZQ55O17s2tYMg4XW2G5DqUGzp1UKiClaDvpN23ZVOlnqDVpIlnVvJ1mz12AzFPny8xD1lhILv78yMltimdaWhyCLcFom0DbloRvYmowjGLHqLTAZ40jI3YUdw39LEqTXgfDF3DnOgZCIdRpouD9cVZBoQroXpVVfWG7sfzKLqWaAEHhjbhdK5l/p3mT7wIDAQABo1AwTjAdBgNVHQ4EFgQUBlCKIZ0+9DQ4ylW86qsyXoW8KjkwHwYDVR0jBBgwFoAUBlCKIZ0+9DQ4ylW86qsyXoW8KjkwDAYDVR0TBAUwAwEB/zANBgkqhkiG9w0BAQsFAAOCAQEAuiE5MocznYDc+JHvEgSaiK9fyRBl/bitKTkiOtxWjEFpF5nH6QddV0pqQziXLb6iSbTBwlDJr9Bwzng8moOYbsD7hP2/mCKJj8o/lsRaPAk+abekWXRqYFNucct/ipBG3s+N2PH+MEpy3ioPH1OBuam6UomjE+mqoP09FrQha1hHEbabt4nN11l8fM5GW+0zRU0SwLFvnR58zUSlTMwczSPA0eUrhEU4AGPD/KN8d1fYnCcWqPF5ePcU11k7SNFl5PZQsgXv9cOc2Vq+qc/NmDBO0rQyKEAPDxbM8CK212G1M+ENTqmuePnr+mNope3AhEsqfH8IOPEoT7fIwmpqLw==\n-----END CERTIFICATE-----",
        "privateKey": "-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDAQw08BODtXPeOoichV/aOc6L/38dgivzFliBTRgccUSKq5Dqdh9fibB7NnrOj0YmibuAeJDcU3Ld835Fq1q1mYGa7K8n7P+5nqlsqay4ks8tPz2iU70nEy1vhrzegcPPd/qtxzaPwrBOviVQNzjnaMsXhlDnk7Xuza1gyDhdbYbkOpQbOnVQqIKVoO+k3bdlU6WeoNWkiWdW8nWbPXYDMU+fLzEPWWEgu/vzIyW2KZ1paHIItwWibQNuWhG9iajCMYseotMBnjSMjdhR3Df0sSpNeB8MXcOc6BkIh1Gmi4P1xVkGhCuhelVV9Ybux/MoupZoAQeGNuF0rmX+neZPvAgMBAAECggEAHm3eV9v7z4WRxtjiMZRO+Q/TQgUkdKK6y/jtR9DDClfLEVoK7ujTocnz/B48l1ZwHq3Gue6IazxdrB1kUhEFI7lpOQF+t83QCUc8o5OQG437RTfx+PSAa+21rpwBRVrrNfz7HIlsA4jwmq01CPRVUrQLfp7rpNBzbhu0u0Ngrf0ccOwXZkEUVvZ55WaPY1YADI9PBExQ2k04LvHJjoz/tJH3nsQLA/+90UXqy8ctUSMJ8Ko3crxJhnIO91BtCugkgS+U+pTEnvdAebE4pd7J5e6qqEyCu9F3DC5R6hH+K8bAj76VGwjxOr9a90o/js92HoCVAlQMHnW06Uk2RdIRmQKBgQD0uQPlA2PLBysWA+IQvd8oBfZuXWQjUZPBU9MK5k7bfuRbNeCA2kbTt1MVf15lv7vcwrwAbYo+Ur+L9CVL3lA8d/lQkz51r1ISChTPUiAMyU+CDDnXjQ1Gik/nC399AeluxS62Tur8hGPAb4rkVEyU60hPFVZTjmv13n81EjUoNwKBgQDJHyiPIgbwI+OoZYMUcGQrsr+yp1MdJrjpuFloc7+sdUpsvelyc146h3+TSAlhDce2BMH68kMUWUYHxHIooQjtDMu9S9b8VAF52F3E9osyjMzsywTri3hgBPy69j/Kr623gbZpbm6lYmdxRp/FKZyWtAbPts45GH1GPdv+9fUmCQKBgQCX7CfDy1fvWXLhBuYXuJfJs/HpT+bzmhgdA5nXgWRhFSRUj1zhASDJHFzi0qBakC3i/a1Soq4YxKwPCTECKXAsKdrHr7Etw/oyIroKfpRQ+8R1GnvqGbGtIf46k8PAaihtUNIP8Wwl+VYnx9c0qjSkmm/YUIm384mIKGlWHAiN/wKBgDV5bF5KLNASqsguXWDE1U1tFF0a8hVRI185HcSQ6gifku9Au14r4ITtW/U79QpyEISL1Uu0uDMj3WPZToUQ8/+bJFyrWnjymQXdimkBKFeDakUXYbKC/bmB+fR33tQ0S5r8CRUVQKQGevx6S6avfqvvJ9R4hXJW2ZAgiGrM2KaJAoGAPXuy4KHRmeeBZj8AT/shQ0VrDWIMNYDrhx0T6q9hVMahBS0SJaKDlQn6cSF7TX5N9PFAbwzcrvRKKfNjQVSZpQdR4l42f+N/5q0c1wihf43k9FgeYQ8jHGJ05uJnh3nj/O57FKgjlZ4FZVQdR8ieHN+rT4sHWj36a/FLHa6p1oo=\n-----END PRIVATE KEY-----"
      },
      "testTrustCA": {
        "class": "CA_Bundle",
        "bundle": "-----BEGIN CERTIFICATE-----\nMIIDxTCCA0qgAwIBAgICEAAwCgYIKoZIzj0EAwMwgZsxCzAJBgNVBAYTAlVTMQsw\nCQYDVQQIDAJXQTEQMA4GA1UEBwwHU2VhdHRsZTEcMBoGA1UECgwTR3JpbGxlZCBD\naGVlc2UgSW5jLjEfMB0GA1UECwwWR3JpbGxlZCBDaGVlc2UgUm9vdCBDQTEuMCwG\nCSqGSIb3DQEJARYfZ3JpbGxlZGNoZWVzZUB5dW1teWlubXl0dW1teS51czAeFw0x\nOTAyMDYyMDQ2NDFaFw0yODEyMTUyMDQ2NDFaMIHSMQswCQYDVQQGEwJVUzELMAkG\nA1UECAwCV0ExHDAaBgNVBAoME0dyaWxsZWQgQ2hlZXNlIEluYy4xJzAlBgNVBAsM\nHkdyaWxsZWQgQ2hlZXNlIEludGVybWVkaWFyeSBDQTE/MD0GA1UEAww2R3JpbGxl\nZCBDaGVlc2UgSW5jLiBJbnRlcm1lZGlhcnkgQ2VydGlmaWNhdGUgQXV0aG9yaXR5\nMS4wLAYJKoZIhvcNAQkBFh9ncmlsbGVkY2hlZXNlQHl1bW15aW5teXR1bW15LnVz\nMHYwEAYHKoZIzj0CAQYFK4EEACIDYgAETcwKVVKK9DbghS3Dvik+OpLCzoOprWvw\nbOl/IiiX7RxdFgJWsQInI1fzKgMoq4s1aatTUry6wViTX8bUCaiCpNCw5EUZ1bf+\niabKwI42zo+muBES7myVFbFLINoyLaO/o4IBJjCCASIwHQYDVR0OBBYEFNnurRrA\nInHSRpZvxY3SbBlMSBxjMB8GA1UdIwQYMBaAFOh9I+Bl//6eA3hxheJXlhg+SeDd\nMBIGA1UdEwEB/wQIMAYBAf8CAQAwDgYDVR0PAQH/BAQDAgGGMEEGA1UdHwQ6MDgw\nNqA0oDKGMGh0dHA6Ly9jcmwuZ3JpbGxlZGNoZWVzZS51cy93aG9tb3ZlZG15Y2hl\nZXNlLmNybDB5BggrBgEFBQcBAQRtMGswPgYIKwYBBQUHMAKGMmh0dHA6Ly9vY3Nw\nLmdyaWxsZWRjaGVlc2UudXMvY2hlZGRhcmNoZWVzZXJvb3QuY3J0MCkGCCsGAQUF\nBzABhh1odHRwOi8vb2NzcC5ncmlsbGVkY2hlZXNlLnVzLzAKBggqhkjOPQQDAwNp\nADBmAjEA7pS9bNHyxZ7gijiWeQrN8hn+rWCgdDggdvFmhFuvmfvv25w9Bgix5AWx\nRjbdQDhYAjEA7s0DRn1xFxoRv5bYKq9BzdLs2J3Q7SKrW4TjJcMR7fg68IxrXf17\nEdC9gMyUkCGZ\n-----END CERTIFICATE-----\n-----BEGIN CERTIFICATE-----\nMIICzzCCAlWgAwIBAgIJAJuPXU1XfaOdMAoGCCqGSM49BAMDMIGbMQswCQYDVQQG\nEwJVUzELMAkGA1UECAwCV0ExEDAOBgNVBAcMB1NlYXR0bGUxHDAaBgNVBAoME0dy\naWxsZWQgQ2hlZXNlIEluYy4xHzAdBgNVBAsMFkdyaWxsZWQgQ2hlZXNlIFJvb3Qg\nQ0ExLjAsBgkqhkiG9w0BCQEWH2dyaWxsZWRjaGVlc2VAeXVtbXlpbm15dHVtbXku\ndXMwHhcNMTkwMjA2MjAzNzE2WhcNMTkwMzA4MjAzNzE2WjCBmzELMAkGA1UEBhMC\nVVMxCzAJBgNVBAgMAldBMRAwDgYDVQQHDAdTZWF0dGxlMRwwGgYDVQQKDBNHcmls\nbGVkIENoZWVzZSBJbmMuMR8wHQYDVQQLDBZHcmlsbGVkIENoZWVzZSBSb290IENB\nMS4wLAYJKoZIhvcNAQkBFh9ncmlsbGVkY2hlZXNlQHl1bW15aW5teXR1bW15LnVz\nMHYwEAYHKoZIzj0CAQYFK4EEACIDYgAE18uEnJFBt+yEzbH5NOEcrPwm/Ay6DMJp\nbFkt+c9GYmwJxN7LREaV3v7CMJDiFtUsBKS7E4BzwgxE0/rsjUlBHFzrLXHBbuRR\ne1+SkBkM3TpeLwXtveNdzN2vgTghtE6/o2MwYTAdBgNVHQ4EFgQU6H0j4GX//p4D\neHGF4leWGD5J4N0wHwYDVR0jBBgwFoAU6H0j4GX//p4DeHGF4leWGD5J4N0wDwYD\nVR0TAQH/BAUwAwEB/zAOBgNVHQ8BAf8EBAMCAYYwCgYIKoZIzj0EAwMDaAAwZQIx\nANsHvQbfAGNSbPfvmtJj8j/9iP8qhO14Rtaiv1CZ8JRCP+CuJiVZ4GVl95dRkt49\nAAIwWEXXpberWlZdTRd4sczN1S706rKZvLgScNRuEltoz/iSEh1MnYZMfuu6kXZ8\nXTuQ\n-----END CERTIFICATE-----"
      }
    }
  }
}
