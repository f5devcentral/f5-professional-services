{
	"info": {
		"_postman_id": "dcf51e35-b57b-41c8-a28a-5c42b38a3f44",
		"name": "F5 XC Deploy",
		"schema": "https://schema.getpostman.com/json/collection/v2.0.0/collection.json"
	},
	"item": [
		{
			"name": "Deploy HTTP App + WAAP (1 App) - Manual DNS/Cert",
			"item": [
				{
					"name": "shared namespace",
					"item": [
						{
							"name": "Create namespace1",
							"id": "e3c462c9-aa47-457c-9155-670e3789700b",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"metadata\": {\n        \"name\": \"{{namespace_1}}\",\n        \"description\": \"\"\n    },\n    \"spec\": {}\n}\n",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": "https://{{voltconsole-host}}.console.ves.volterra.io/api/web/namespaces",
								"description": "Shared NamesSpace Sites"
							},
							"response": []
						},
						{
							"name": "Create Shared App Firewall",
							"id": "9d650be2-b700-4e19-b4b6-9145540bf5c2",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"metadata\": {\n    \"name\": \"{{shared-appfw-name}}\",\n    \"namespace\": \"shared\",\n    \"labels\": {},\n    \"annotations\": {},\n    \"description\": \"\",\n    \"disable\": false\n  },\n  \"spec\": {\n    \"blocking\": {},\n    \"default_detection_settings\": {},\n    \"default_bot_setting\": {},\n    \"allow_all_response_codes\": {},\n    \"default_anonymization\": {},\n    \"use_default_blocking_page\": {}\n  }\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": "https://{{voltconsole-host}}.console.ves.volterra.io/api/config/namespaces/shared/app_firewalls",
								"description": "Shared NamesSpace Sites"
							},
							"response": []
						},
						{
							"name": "Create Shared Service Policy- block-countries",
							"id": "250b575e-7946-42a8-9c94-c561f44c06b0",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"metadata\": {\n    \"name\": \"web-srvpolicy-block-countries\",\n    \"namespace\": \"shared\",\n    \"labels\": {},\n    \"annotations\": {},\n    \"description\": null,\n    \"disable\": null\n  },\n  \"spec\": {\n    \"algo\": \"FIRST_MATCH\",\n    \"any_server\": {},\n    \"port_matcher\": null,\n    \"deny_list\": {\n      \"prefix_list\": null,\n      \"ip_prefix_set\": null,\n      \"asn_list\": null,\n      \"asn_set\": null,\n      \"country_list\": [\n        \"COUNTRY_CU\",\n        \"COUNTRY_IR\",\n        \"COUNTRY_KP\",\n        \"COUNTRY_LY\",\n        \"COUNTRY_SY\",\n        \"COUNTRY_SD\"\n      ],\n      \"tls_fingerprint_classes\": null,\n      \"tls_fingerprint_values\": null,\n      \"default_action_next_policy\": {}\n    }\n  },\n  \"resource_version\": null\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": "https://{{voltconsole-host}}.console.ves.volterra.io/api/config/namespaces/shared/service_policys",
								"description": "Shared NamesSpace Sites"
							},
							"response": []
						},
						{
							"name": "Create Shared Service Policy - allowed-http-methods",
							"id": "84bab523-aebb-49a8-834e-4d5cb4bbc98b",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"metadata\": {\n    \"name\": \"web-srvpolicy-allowed-http-methods\",\n    \"namespace\": \"shared\",\n    \"labels\": {},\n    \"annotations\": {},\n    \"description\": null,\n    \"disable\": null\n  },\n  \"spec\": {\n    \"algo\": \"FIRST_MATCH\",\n    \"any_server\": {},\n    \"port_matcher\": null,\n    \"rule_list\": {\n      \"rules\": [\n        {\n          \"metadata\": {\n            \"name\": \"policy-allow\",\n            \"description\": null,\n            \"disable\": null\n          },\n          \"spec\": {\n            \"action\": \"ALLOW\",\n            \"any_client\": {},\n            \"client_role\": null,\n            \"server_selector\": null,\n            \"label_matcher\": {\n              \"keys\": null\n            },\n            \"path\": null,\n            \"headers\": null,\n            \"query_params\": null,\n            \"http_method\": {\n              \"methods\": [\n                \"GET\",\n                \"HEAD\",\n                \"POST\"\n              ],\n              \"invert_matcher\": null\n            },\n            \"any_ip\": {},\n            \"any_asn\": {},\n            \"api_group_matcher\": null,\n            \"port_matcher\": null,\n            \"expiration_timestamp\": null,\n            \"body_matcher\": null,\n            \"arg_matchers\": null,\n            \"cookie_matchers\": null,\n            \"waf_action\": {\n              \"none\": {}\n            },\n            \"domain_matcher\": null,\n            \"rate_limiter\": null,\n            \"virtual_host_matcher\": null,\n            \"tls_fingerprint_matcher\": null,\n            \"forwarding_class\": null,\n            \"malicious_user_mitigation_bypass\": null,\n            \"scheme\": null,\n            \"url_matcher\": null,\n            \"l4_dest_matcher\": null,\n            \"challenge_action\": \"DEFAULT_CHALLENGE\",\n            \"goto_policy\": null\n          }\n        }\n      ]\n    }\n  },\n  \"resource_version\": null\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": "https://{{voltconsole-host}}.console.ves.volterra.io/api/config/namespaces/shared/service_policys",
								"description": "Shared NamesSpace Sites"
							},
							"response": []
						}
					],
					"id": "c8b20e06-9df4-4b9c-89e3-4e38dd663f88"
				},
				{
					"name": "Namespace1",
					"item": [
						{
							"name": "Create Health Check",
							"id": "7a774be3-df96-4b35-a4a3-d55a6338e506",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"metadata\": {\n    \"name\": \"{{app_name_1}}-tcp-check\",\n    \"namespace\": \"{{namespace_1}}\",\n    \"labels\": {},\n    \"annotations\": {},\n    \"description\": null,\n    \"disable\": null\n  },\n  \"spec\": {\n    \"tcp_health_check\": {\n      \"send_payload\": null,\n      \"expected_response\": null\n    },\n    \"timeout\": 3,\n    \"interval\": 15,\n    \"unhealthy_threshold\": 1,\n    \"healthy_threshold\": 3,\n    \"jitter_percent\": 30\n  },\n  \"resource_version\": null\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": "https://{{voltconsole-host}}.console.ves.volterra.io/api/config/namespaces/{{namespace_1}}/healthchecks",
								"description": "Shared NamesSpace Sites"
							},
							"response": []
						},
						{
							"name": "Create Origin Pool",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"id": "74447a93-8b40-465c-958c-afc49a7a3328",
										"exec": [
											"//Create Pool Config",
											"var poolName = pm.environment.get(\"pool_1\");",
											"var poolNameArray = poolName.split(',');",
											"var poolConfig = \"\\\"origin_servers\\\": [ \";",
											"for(var i = 0; i < poolNameArray.length; i++) {",
											"    var poolMember = poolNameArray[i].trim()",
											"    //console.log(\"Pool member:\"+poolMember);",
											"    var isIP = is_IP(poolMember);",
											"    var HowManyLeft = poolNameArray.length - i;",
											"    if (isIP === true) {",
											"        poolConfig = poolConfig+\"{ \\\"public_ip\\\": { \\\"ip\\\": \\\"\"+poolMember+\"\\\" }, \\\"labels\\\": {} } \";",
											"        if (HowManyLeft > 1) {",
											"            poolConfig = poolConfig+\",\"",
											"        }",
											"    }",
											"    else {",
											"        poolConfig = poolConfig+\"{ \\\"public_name\\\": { \\\"dns_name\\\": \\\"\"+poolMember+\"\\\" }, \\\"labels\\\": {} } \";",
											"        if (HowManyLeft > 1) {",
											"            poolConfig = poolConfig+\",\"",
											"        }",
											"    }",
											"}",
											"poolConfig = poolConfig+\"]\"",
											"pm.collectionVariables.set(\"poolConfig\", poolConfig);",
											"delete poolConfig;",
											"",
											"",
											"",
											"",
											"",
											"//Function to determine if pool member type is an IP or DNS name",
											"function is_IP(str)",
											"{",
											"    regexp =  /^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;",
											"    if (regexp.test(str)) {",
											"        return true;",
											"    }",
											"    else {",
											"        return false;",
											"    }",
											"}"
										],
										"type": "text/javascript"
									}
								}
							],
							"id": "f7e589b2-0097-40cb-81b7-07a40d07540f",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"metadata\": {\n    \"name\": \"{{app_name_1}}-pool\",\n    \"namespace\": \"{{namespace_1}}\",\n    \"labels\": {},\n    \"annotations\": {},\n    \"description\": null,\n    \"disable\": null\n  },\n  \"spec\": {\n    {{poolConfig}},\n    \"use_tls\": {\n      \"use_host_header_as_sni\": {},\n      \"tls_config\": {\n        \"default_security\": {}\n      },\n      \"volterra_trusted_ca\": {},\n      \"no_mtls\": {}\n    },\n    \"port\": 443,\n    \"same_as_endpoint_port\": {},\n    \"healthcheck\": [\n      {\n        \"namespace\": \"{{namespace_1}}\",\n        \"name\": \"{{app_name_1}}-tcp-check\"\n      }\n    ],\n    \"loadbalancer_algorithm\": \"LB_OVERRIDE\",\n    \"endpoint_selection\": \"LOCAL_PREFERRED\",\n    \"advanced_options\": null\n  },\n  \"resource_version\": null\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": "https://{{voltconsole-host}}.console.ves.volterra.io/api/config/namespaces/{{namespace_1}}/origin_pools",
								"description": "Shared NamesSpace Sites"
							},
							"response": []
						},
						{
							"name": "Create Web App Firewall",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"id": "6ba44685-80e3-4e2e-bdbe-d106d7b7fcbf",
										"exec": [
											"//Determine Key Type ",
											"var TLSkey = pm.environment.get(\"namespace_1-key\");",
											"if (TLSkey.includes(\"-----BEGIN PRIVATE KEY-----\")) {",
											"    postman.setNextRequest(\"Create HTTP LB - Cleartext Key\");",
											"}",
											"else {",
											"    postman.setNextRequest(\"Create HTTP LB - Blindfold Key\");",
											"}"
										],
										"type": "text/javascript"
									}
								}
							],
							"id": "b35f8585-f4d3-4253-88ab-6a2fea2f30ee",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"metadata\": {\n    \"name\": \"{{app_name_1}}-appwf\",\n    \"namespace\": \"{{namespace_1}}\",\n    \"labels\": {},\n    \"annotations\": {},\n    \"description\": null,\n    \"disable\": null\n  },\n  \"spec\": {\n    \"app_profile\": null,\n    \"mode\": \"BLOCK\",\n    \"disabled_detection_tags\": null\n  },\n  \"resource_version\": null\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": "https://{{voltconsole-host}}.console.ves.volterra.io/api/config/namespaces/{{namespace_1}}/app_firewalls",
								"description": "Shared NamesSpace Sites"
							},
							"response": []
						},
						{
							"name": "Create HTTP LB - Blindfold Key",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "9b847ed7-2e7d-49de-9c43-c40b5a951a16",
										"exec": [
											"postman.setNextRequest(null);"
										],
										"type": "text/javascript"
									}
								}
							],
							"id": "d3d4143b-f7ed-4dd7-ac42-10a9ddd3b053",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"metadata\": {\n    \"name\": \"{{app_name_1}}-http-lb\",\n    \"namespace\": \"{{namespace_1}}\",\n    \"labels\": {},\n    \"annotations\": {},\n    \"description\": null,\n    \"disable\": null\n  },\n  \"spec\": {\n    \"domains\": [\n      \"{{namespace_1-http-lb-domain}}\"\n    ],\n    \"https\": {\n            \"http_redirect\": null,\n            \"add_hsts\": null,\n            \"tls_parameters\": {\n                \"tls_config\": {\n                    \"default_security\": {}\n                },\n                \"tls_certificates\": [\n                    {\n                        \"certificate_url\": \"string:///{{base64EncodedCert}}\",\n                        \"private_key\": {\n                            \"blindfold_secret_info\": {\n                                \"location\": \"string:///{{namespace_1-key}}\",\n                                \"decryption_provider\": null,\n                                \"store_provider\": null\n                            },\n                            \"blindfold_secret_info_internal\": null,\n                            \"secret_encoding_type\": null\n                        },\n                        \"description\": null\n                    }\n                ],\n                \"no_mtls\": {}\n            },\n            \"default_header\": {}\n        },\n    \"advertise_on_public_default_vip\": {},\n    \"default_route_pools\": [\n      {\n        \"pool\": {\n          \"namespace\": \"{{namespace_1}}\",\n          \"name\": \"{{app_name_1}}-pool\"\n        },\n        \"weight\": 1,\n        \"endpoint_subsets\": {}\n      }\n    ],\n    \"routes\": null,\n    {{appFwConfig}}\n    \"add_location\": null,\n    \"no_challenge\": {},\n    \"more_option\": null,\n    \"user_identification\": null,\n    \"disable_rate_limit\": {},\n    \"malicious_user_mitigation\": null,\n    \"waf_exclusion_rules\": null,\n    \"blocked_clients\": null,\n    \"trusted_clients\": null,\n    \"ddos_mitigation_rules\": null,\n    {{svcPolConfig}}\n    \"single_lb_app\": {\n      \"enable_discovery\": {\n        \"disable_learn_from_redirect_traffic\": {}\n      },\n      \"enable_ddos_detection\": {},\n      \"enable_malicious_user_detection\": {}\n    },\n    \"disable_bot_defense\": {},\n    \"round_robin\": {}\n  },\n  \"resource_version\": null\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": "https://{{voltconsole-host}}.console.ves.volterra.io/api/config/namespaces/{{namespace_1}}/http_loadbalancers",
								"description": "Shared NamesSpace Sites"
							},
							"response": []
						},
						{
							"name": "Create HTTP LB - Cleartext Key",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "d92feb23-49d1-49a7-a8f9-422e438cddfb",
										"exec": [
											"postman.setNextRequest(null);"
										],
										"type": "text/javascript"
									}
								}
							],
							"id": "91b7b0dd-b618-4233-910c-f98935a4e068",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"metadata\": {\n    \"name\": \"{{app_name_1}}-http-lb\",\n    \"namespace\": \"{{namespace_1}}\",\n    \"labels\": {},\n    \"annotations\": {},\n    \"description\": null,\n    \"disable\": null\n  },\n  \"spec\": {\n    \"domains\": [\n      \"{{namespace_1-http-lb-domain}}\"\n    ],\n    \"https\": {\n            \"http_redirect\": null,\n            \"add_hsts\": null,\n            \"tls_parameters\": {\n                \"tls_config\": {\n                    \"default_security\": {}\n                },\n                \"tls_certificates\": [\n                    {\n                        \"certificate_url\": \"string:///{{base64EncodedCert}}\",\n                        \"private_key\": {\n                            \"clear_secret_info\": {\n                                \"url\": \"string:///{{base64EncodedKey}}\",\n                                \"provider\": null\n                            },\n                            \"blindfold_secret_info_internal\": null,\n                            \"secret_encoding_type\": \"EncodingNone\"\n                        },\n                        \"description\": null\n                    }\n                ],\n                \"no_mtls\": {}\n            },\n            \"default_header\": {}\n        },\n    \"advertise_on_public_default_vip\": {},\n    \"default_route_pools\": [\n      {\n        \"pool\": {\n          \"namespace\": \"{{namespace_1}}\",\n          \"name\": \"{{app_name_1}}-pool\"\n        },\n        \"weight\": 1,\n        \"endpoint_subsets\": {}\n      }\n    ],\n    \"routes\": null,\n    {{appFwConfig}}\n    \"add_location\": null,\n    \"no_challenge\": {},\n    \"more_option\": null,\n    \"user_identification\": null,\n    \"disable_rate_limit\": {},\n    \"malicious_user_mitigation\": null,\n    \"waf_exclusion_rules\": null,\n    \"blocked_clients\": null,\n    \"trusted_clients\": null,\n    \"ddos_mitigation_rules\": null,\n    {{svcPolConfig}}\n    \"single_lb_app\": {\n      \"enable_discovery\": {\n        \"disable_learn_from_redirect_traffic\": {}\n      },\n      \"enable_ddos_detection\": {},\n      \"enable_malicious_user_detection\": {}\n    },\n    \"disable_bot_defense\": {},\n    \"round_robin\": {}\n  },\n  \"resource_version\": null\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": "https://{{voltconsole-host}}.console.ves.volterra.io/api/config/namespaces/{{namespace_1}}/http_loadbalancers",
								"description": "Shared NamesSpace Sites"
							},
							"response": []
						}
					],
					"id": "eeac2b84-5dce-4252-915c-691e94009f16"
				}
			],
			"id": "68855377-2997-42c3-a68a-7695d1a91976",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "66066e4a-4a79-46ea-a92c-a75e249ec5ad",
						"type": "text/javascript",
						"exec": [
							"pm.collectionVariables.set(\"base64EncodedCert\", btoa(pm.environment.get(\"namespace_1-cert\")));",
							"pm.collectionVariables.set(\"base64EncodedKey\", btoa(pm.environment.get(\"namespace_1-key\")));",
							"",
							"//Create Pool Config",
							"var poolName = pm.environment.get(\"pool_1\");",
							"var poolNameArray = poolName.split(',');",
							"var poolConfig = \"\\\"origin_servers\\\": [ \";",
							"for(var i = 0; i < poolNameArray.length; i++) {",
							"    var poolMember = poolNameArray[i].trim()",
							"    //console.log(\"Pool member:\"+poolMember);",
							"    var isIP = is_IP(poolMember);",
							"    var HowManyLeft = poolNameArray.length - i;",
							"    if (isIP === true) {",
							"        poolConfig = poolConfig+\"{ \\\"public_ip\\\": { \\\"ip\\\": \\\"\"+poolMember+\"\\\" }, \\\"labels\\\": {} } \";",
							"        if (HowManyLeft > 1) {",
							"            poolConfig = poolConfig+\",\"",
							"        }",
							"    }",
							"    else {",
							"        poolConfig = poolConfig+\"{ \\\"public_name\\\": { \\\"dns_name\\\": \\\"\"+poolMember+\"\\\" }, \\\"labels\\\": {} } \";",
							"        if (HowManyLeft > 1) {",
							"            poolConfig = poolConfig+\",\"",
							"        }",
							"    }",
							"}",
							"poolConfig = poolConfig+\"]\"",
							"pm.collectionVariables.set(\"poolConfig\", poolConfig);",
							"delete poolConfig;",
							"",
							"",
							"",
							"//Function to determine if pool member type is an IP or DNS name",
							"function is_IP(str)",
							"{",
							"    regexp =  /^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;",
							"    if (regexp.test(str)) {",
							"        return true;",
							"    }",
							"    else {",
							"        return false;",
							"    }",
							"}",
							"",
							"//Build WAF and Service Policy Configuration",
							"let deployAppFW = pm.environment.get(\"apply_shared-appfw\")",
							"let deploySvcPol = pm.environment.get(\"apply_shared-svcpol\")",
							"let namespace1 = pm.environment.get(\"namespace_1\")",
							"let appName1 = pm.environment.get(\"app_name_1\")",
							"let AppFwName = pm.environment.get(\"shared-appfw-name\")",
							"let tenantID = pm.environment.get(\"tenant-id\")",
							"var appFwConfig = \"\";",
							"var svcPolConfig = \"\";",
							"",
							"//build APP FW Config",
							"if (deployAppFW === \"yes\") {",
							"    appFwConfig = \"\\\"app_firewall\\\": { \\\"namespace\\\": \\\"shared\\\",\\\"name\\\": \\\"\"+AppFwName+\"\\\"},\";",
							"}",
							"else {",
							"    appFwConfig = \"\\\"disable_waf\\\": {},\"",
							"}",
							"//Build Service Policy Config",
							"if (deploySvcPol === \"yes\") {",
							"    svcPolConfig = \"\\\"active_service_policies\\\": { \\\"policies\\\": [ { \\\"namespace\\\": \\\"shared\\\", \\\"name\\\": \\\"web-srvpolicy-block-countries\\\" }, { \\\"tenant\\\": \\\"\"+tenantID+\"\\\", \\\"namespace\\\": \\\"shared\\\", \\\"name\\\": \\\"web-srvpolicy-allowed-http-methods\\\" } ] },\";",
							"}",
							"else {",
							"    svcPolConfig = \"\\\"service_policies_from_namespace\\\": {},\"",
							"}",
							"//Set Configurations to collection variables",
							"pm.collectionVariables.set(\"appFwConfig\", appFwConfig);",
							"pm.collectionVariables.set(\"svcPolConfig\", svcPolConfig);",
							"delete appFwConfig;",
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "c8be8220-da32-43e2-abf5-9e349aa3cfe1",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			]
		},
		{
			"name": "Deploy HTTP App + WAAP (1 App) - Auto DNS/Cert",
			"item": [
				{
					"name": "shared namespace",
					"item": [
						{
							"name": "Create namespace1",
							"id": "e43b6447-7223-40d5-9bd5-ff7419cddc08",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"metadata\": {\n        \"name\": \"{{namespace_1}}\",\n        \"description\": \"\"\n    },\n    \"spec\": {}\n}\n",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": "https://{{voltconsole-host}}.console.ves.volterra.io/api/web/namespaces",
								"description": "Shared NamesSpace Sites"
							},
							"response": []
						},
						{
							"name": "Create Shared App Firewall",
							"id": "1f05778e-1855-40d5-9b66-92b6cb4fb470",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"metadata\": {\n    \"name\": \"{{shared-appfw-name}}\",\n    \"namespace\": \"shared\",\n    \"labels\": {},\n    \"annotations\": {},\n    \"description\": \"\",\n    \"disable\": false\n  },\n  \"spec\": {\n    \"blocking\": {},\n    \"default_detection_settings\": {},\n    \"default_bot_setting\": {},\n    \"allow_all_response_codes\": {},\n    \"default_anonymization\": {},\n    \"use_default_blocking_page\": {}\n  }\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": "https://{{voltconsole-host}}.console.ves.volterra.io/api/config/namespaces/shared/app_firewalls",
								"description": "Shared NamesSpace Sites"
							},
							"response": []
						},
						{
							"name": "Create Shared Service Policy- block-countries",
							"id": "3e20a607-c756-4bda-9a5a-924e258787f7",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"metadata\": {\n    \"name\": \"web-srvpolicy-block-countries\",\n    \"namespace\": \"shared\",\n    \"labels\": {},\n    \"annotations\": {},\n    \"description\": null,\n    \"disable\": null\n  },\n  \"spec\": {\n    \"algo\": \"FIRST_MATCH\",\n    \"any_server\": {},\n    \"port_matcher\": null,\n    \"deny_list\": {\n      \"prefix_list\": null,\n      \"ip_prefix_set\": null,\n      \"asn_list\": null,\n      \"asn_set\": null,\n      \"country_list\": [\n        \"COUNTRY_CU\",\n        \"COUNTRY_IR\",\n        \"COUNTRY_KP\",\n        \"COUNTRY_LY\",\n        \"COUNTRY_SY\",\n        \"COUNTRY_SD\"\n      ],\n      \"tls_fingerprint_classes\": null,\n      \"tls_fingerprint_values\": null,\n      \"default_action_next_policy\": {}\n    }\n  },\n  \"resource_version\": null\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": "https://{{voltconsole-host}}.console.ves.volterra.io/api/config/namespaces/shared/service_policys",
								"description": "Shared NamesSpace Sites"
							},
							"response": []
						},
						{
							"name": "Create Shared Service Policy - allowed-http-methods",
							"id": "e714fa64-bb62-410d-86ae-7b06d113ce61",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"metadata\": {\n    \"name\": \"web-srvpolicy-allowed-http-methods\",\n    \"namespace\": \"shared\",\n    \"labels\": {},\n    \"annotations\": {},\n    \"description\": null,\n    \"disable\": null\n  },\n  \"spec\": {\n    \"algo\": \"FIRST_MATCH\",\n    \"any_server\": {},\n    \"port_matcher\": null,\n    \"rule_list\": {\n      \"rules\": [\n        {\n          \"metadata\": {\n            \"name\": \"policy-allow\",\n            \"description\": null,\n            \"disable\": null\n          },\n          \"spec\": {\n            \"action\": \"ALLOW\",\n            \"any_client\": {},\n            \"client_role\": null,\n            \"server_selector\": null,\n            \"label_matcher\": {\n              \"keys\": null\n            },\n            \"path\": null,\n            \"headers\": null,\n            \"query_params\": null,\n            \"http_method\": {\n              \"methods\": [\n                \"GET\",\n                \"HEAD\",\n                \"POST\"\n              ],\n              \"invert_matcher\": null\n            },\n            \"any_ip\": {},\n            \"any_asn\": {},\n            \"api_group_matcher\": null,\n            \"port_matcher\": null,\n            \"expiration_timestamp\": null,\n            \"body_matcher\": null,\n            \"arg_matchers\": null,\n            \"cookie_matchers\": null,\n            \"waf_action\": {\n              \"none\": {}\n            },\n            \"domain_matcher\": null,\n            \"rate_limiter\": null,\n            \"virtual_host_matcher\": null,\n            \"tls_fingerprint_matcher\": null,\n            \"forwarding_class\": null,\n            \"malicious_user_mitigation_bypass\": null,\n            \"scheme\": null,\n            \"url_matcher\": null,\n            \"l4_dest_matcher\": null,\n            \"challenge_action\": \"DEFAULT_CHALLENGE\",\n            \"goto_policy\": null\n          }\n        }\n      ]\n    }\n  },\n  \"resource_version\": null\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": "https://{{voltconsole-host}}.console.ves.volterra.io/api/config/namespaces/shared/service_policys",
								"description": "Shared NamesSpace Sites"
							},
							"response": []
						}
					],
					"id": "5754b828-6e68-476e-adea-76f9725ad782"
				},
				{
					"name": "Namespace1",
					"item": [
						{
							"name": "Create Health Check",
							"id": "86aabf73-a003-471c-bd36-b07cb3e4bf43",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"metadata\": {\n    \"name\": \"{{app_name_1}}-tcp-check\",\n    \"namespace\": \"{{namespace_1}}\",\n    \"labels\": {},\n    \"annotations\": {},\n    \"description\": null,\n    \"disable\": null\n  },\n  \"spec\": {\n    \"tcp_health_check\": {\n      \"send_payload\": null,\n      \"expected_response\": null\n    },\n    \"timeout\": 3,\n    \"interval\": 15,\n    \"unhealthy_threshold\": 1,\n    \"healthy_threshold\": 3,\n    \"jitter_percent\": 30\n  },\n  \"resource_version\": null\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": "https://{{voltconsole-host}}.console.ves.volterra.io/api/config/namespaces/{{namespace_1}}/healthchecks",
								"description": "Shared NamesSpace Sites"
							},
							"response": []
						},
						{
							"name": "Create Origin Pool",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"id": "74447a93-8b40-465c-958c-afc49a7a3328",
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								}
							],
							"id": "5bf19751-8a7b-4ead-9128-9b575f6ad13b",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"metadata\": {\n    \"name\": \"{{app_name_1}}-pool\",\n    \"namespace\": \"{{namespace_1}}\",\n    \"labels\": {},\n    \"annotations\": {},\n    \"description\": null,\n    \"disable\": null\n  },\n  \"spec\": {\n    {{poolConfig}},\n    \"use_tls\": {\n      \"use_host_header_as_sni\": {},\n      \"tls_config\": {\n        \"default_security\": {}\n      },\n      \"volterra_trusted_ca\": {},\n      \"no_mtls\": {}\n    },\n    \"port\": 443,\n    \"same_as_endpoint_port\": {},\n    \"healthcheck\": [\n      {\n        \"namespace\": \"{{namespace_1}}\",\n        \"name\": \"{{app_name_1}}-tcp-check\"\n      }\n    ],\n    \"loadbalancer_algorithm\": \"LB_OVERRIDE\",\n    \"endpoint_selection\": \"LOCAL_PREFERRED\",\n    \"advanced_options\": null\n  },\n  \"resource_version\": null\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": "https://{{voltconsole-host}}.console.ves.volterra.io/api/config/namespaces/{{namespace_1}}/origin_pools",
								"description": "Shared NamesSpace Sites"
							},
							"response": []
						},
						{
							"name": "Create Web App Firewall",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"id": "6ba44685-80e3-4e2e-bdbe-d106d7b7fcbf",
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								}
							],
							"id": "2a609fbb-4636-4320-8ce7-f2d92783eb3d",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"metadata\": {\n    \"name\": \"{{app_name_1}}-appwf\",\n    \"namespace\": \"{{namespace_1}}\",\n    \"labels\": {},\n    \"annotations\": {},\n    \"description\": null,\n    \"disable\": null\n  },\n  \"spec\": {\n    \"app_profile\": null,\n    \"mode\": \"BLOCK\",\n    \"disabled_detection_tags\": null\n  },\n  \"resource_version\": null\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": "https://{{voltconsole-host}}.console.ves.volterra.io/api/config/namespaces/{{namespace_1}}/app_firewalls",
								"description": "Shared NamesSpace Sites"
							},
							"response": []
						},
						{
							"name": "Create HTTP LB",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "d92feb23-49d1-49a7-a8f9-422e438cddfb",
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								}
							],
							"id": "f0558b0b-d7bb-4ad9-88ee-91c5f04d144b",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"metadata\": {\n    \"name\": \"{{app_name_1}}-http-lb\",\n    \"namespace\": \"{{namespace_1}}\",\n    \"labels\": {},\n    \"annotations\": {},\n    \"description\": null,\n    \"disable\": null\n  },\n  \"spec\": {\n    \"domains\": [\n      \"{{namespace_1-http-lb-domain}}\"\n    ],\n    \"https_auto_cert\": {\n      \"http_redirect\": true,\n      \"add_hsts\": true,\n      \"port\": 443,\n      \"tls_config\": {\n        \"default_security\": {}\n      },\n      \"no_mtls\": {},\n      \"default_header\": {},\n      \"enable_path_normalize\": {}\n    },\n    \"advertise_on_public_default_vip\": {},\n    \"default_route_pools\": [\n      {\n        \"pool\": {\n          \"namespace\": \"{{namespace_1}}\",\n          \"name\": \"{{app_name_1}}-pool\"\n        },\n        \"weight\": 1,\n        \"priority\": 1,\n        \"endpoint_subsets\": {}\n      }\n    ],\n    \"routes\": null,\n    \"cors_policy\": null,\n    {{appFwConfig}}\n    \"add_location\": null,\n    \"no_challenge\": {},\n    \"more_option\": {\n      \"request_headers_to_add\": [\n        {\n          \"name\": \"wl-proxy-client-ip\",\n          \"value\": \"$[client_address]\",\n          \"append\": null\n        }\n      ],\n      \"request_headers_to_remove\": null,\n      \"response_headers_to_add\": null,\n      \"response_headers_to_remove\": null,\n      \"max_request_header_size\": 60,\n      \"buffer_policy\": null,\n      \"compression_params\": null,\n      \"custom_errors\": {},\n      \"javascript_info\": null,\n      \"jwt\": null,\n      \"idle_timeout\": 30000,\n      \"disable_default_error_pages\": null\n    },\n    \"user_id_client_ip\": {},\n    \"disable_rate_limit\": {},\n    \"malicious_user_mitigation\": null,\n    \"waf_exclusion_rules\": null,\n    \"blocked_clients\": null,\n    \"trusted_clients\": null,\n    \"ddos_mitigation_rules\": null,\n    {{svcPolConfig}}\n    \"single_lb_app\": {\n      \"enable_discovery\": {\n        \"disable_learn_from_redirect_traffic\": {}\n      },\n      \"enable_ddos_detection\": {},\n      \"enable_malicious_user_detection\": {}\n    },\n    \"disable_bot_defense\": {},\n    \"round_robin\": {}\n  },\n  \"resource_version\": null\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": "https://{{voltconsole-host}}.console.ves.volterra.io/api/config/namespaces/{{namespace_1}}/http_loadbalancers",
								"description": "Shared NamesSpace Sites"
							},
							"response": []
						}
					],
					"id": "d8f42641-3021-42e6-b9bd-c9109e7a4ba3"
				}
			],
			"id": "cd6ddf23-e911-4306-b374-ddd3ca843a89",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "b15dd25c-4e4f-454f-ac76-dc2806387756",
						"type": "text/javascript",
						"exec": [
							"//Create Pool Config",
							"var poolName = pm.environment.get(\"pool_1\");",
							"var poolNameArray = poolName.split(',');",
							"var poolConfig = \"\\\"origin_servers\\\": [ \";",
							"for(var i = 0; i < poolNameArray.length; i++) {",
							"    var poolMember = poolNameArray[i].trim()",
							"    //console.log(\"Pool member:\"+poolMember);",
							"    var isIP = is_IP(poolMember);",
							"    var HowManyLeft = poolNameArray.length - i;",
							"    if (isIP === true) {",
							"        poolConfig = poolConfig+\"{ \\\"public_ip\\\": { \\\"ip\\\": \\\"\"+poolMember+\"\\\" }, \\\"labels\\\": {} } \";",
							"        if (HowManyLeft > 1) {",
							"            poolConfig = poolConfig+\",\"",
							"        }",
							"    }",
							"    else {",
							"        poolConfig = poolConfig+\"{ \\\"public_name\\\": { \\\"dns_name\\\": \\\"\"+poolMember+\"\\\" }, \\\"labels\\\": {} } \";",
							"        if (HowManyLeft > 1) {",
							"            poolConfig = poolConfig+\",\"",
							"        }",
							"    }",
							"}",
							"poolConfig = poolConfig+\"]\"",
							"pm.collectionVariables.set(\"poolConfig\", poolConfig);",
							"delete poolConfig;",
							"",
							"",
							"",
							"//Function to determine if pool member type is an IP or DNS name",
							"function is_IP(str)",
							"{",
							"    regexp =  /^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;",
							"    if (regexp.test(str)) {",
							"        return true;",
							"    }",
							"    else {",
							"        return false;",
							"    }",
							"}",
							"",
							"//Build WAF and Service Policy Configuration",
							"let deployAppFW = pm.environment.get(\"apply_shared-appfw\")",
							"let deploySvcPol = pm.environment.get(\"apply_shared-svcpol\")",
							"let tenantID = pm.environment.get(\"tenant-id\")",
							"let namespace1 = pm.environment.get(\"namespace_1\")",
							"let appName1 = pm.environment.get(\"app_name_1\")",
							"let AppFwName = pm.environment.get(\"shared-appfw-name\")",
							"var appFwConfig = \"\";",
							"var svcPolConfig = \"\";",
							"",
							"//build APP FW Config",
							"if (deployAppFW === \"yes\") {",
							"    appFwConfig = \"\\\"app_firewall\\\": { \\\"tenant\\\": \\\"\"+tenantID+\"\\\", \\\"namespace\\\": \\\"shared\\\",\\\"name\\\": \\\"\"+AppFwName+\"\\\"},\";",
							"}",
							"else {",
							"    appFwConfig = \"\\\"disable_waf\\\": {},\"",
							"}",
							"//Build Service Policy Config",
							"if (deploySvcPol === \"yes\") {",
							"    svcPolConfig = \"\\\"active_service_policies\\\": { \\\"policies\\\": [ { \\\"tenant\\\": \\\"\"+tenantID+\"\\\",\\\"namespace\\\": \\\"shared\\\", \\\"name\\\": \\\"web-srvpolicy-block-countries\\\" }, { \\\"tenant\\\": \\\"\"+tenantID+\"\\\", \\\"namespace\\\": \\\"shared\\\", \\\"name\\\": \\\"web-srvpolicy-allowed-http-methods\\\" } ] },\";",
							"}",
							"else {",
							"    svcPolConfig = \"\\\"service_policies_from_namespace\\\": {},\"",
							"}",
							"//Set Configurations to collection variables",
							"pm.collectionVariables.set(\"appFwConfig\", appFwConfig);",
							"pm.collectionVariables.set(\"svcPolConfig\", svcPolConfig);",
							"delete appFwConfig;",
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "a5ee54ae-07fd-4f99-8eef-e9abddf281a6",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			]
		}
	],
	"auth": {
		"type": "apikey",
		"apikey": {
			"value": "APIToken {{api_credential}}",
			"key": "Authorization"
		}
	},
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"id": "083c08a2-c6ce-446c-961c-a9dcc698b688",
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"id": "d6cd00a8-e98d-471d-9faf-4ac31be92595",
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"id": "d4c6e077-961b-44c9-aed7-63d9bb72a927",
			"key": "base64EncodedCert",
			"value": ""
		},
		{
			"id": "82e20f6e-b2c7-4954-b07a-5ec89883aa65",
			"key": "base64EncodedKey",
			"value": ""
		},
		{
			"id": "11fc34f3-8c7b-43a2-833a-5bebe2f17942",
			"key": "poolConfig",
			"value": ""
		},
		{
			"id": "05c3610f-5d37-404b-9221-e0687e558de8",
			"key": "appFwConfig",
			"value": ""
		},
		{
			"id": "0bc9fb2b-8759-44cf-85a7-131bac51f4d4",
			"key": "svcPolConfig",
			"value": ""
		}
	]
}
